# vite-learning-history

### å®šä¹‰
[Vite](https://cn.vitejs.dev/)æ˜¯ä¸€ç§æ–°åž‹å‰ç«¯æž„å»ºå·¥å…·ï¼Œèƒ½å¤Ÿæ˜¾è‘—æå‡å‰ç«¯å¼€å‘ä½“éªŒã€‚å®ƒä¸»è¦ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š
- ä¸€ä¸ªå¼€å‘æœåŠ¡å™¨ï¼Œå®ƒåŸºäºŽ`åŽŸç”Ÿ ESæ¨¡å—`æä¾›äº†ä¸°å¯Œçš„å†…å»ºåŠŸèƒ½ï¼Œå¦‚é€Ÿåº¦å¿«åˆ°æƒŠäººçš„ `æ¨¡å—çƒ­æ›´æ–°`ï¼ˆHMRï¼‰ã€‚
- ä¸€å¥—æž„å»ºæŒ‡ä»¤ï¼Œå®ƒä½¿ç”¨`Rollup`æ‰“åŒ…ä½ çš„ä»£ç ï¼Œå¹¶ä¸”å®ƒæ˜¯é¢„é…ç½®çš„ï¼Œå¯è¾“å‡ºç”¨äºŽç”Ÿäº§çŽ¯å¢ƒçš„é«˜åº¦ä¼˜åŒ–è¿‡çš„é™æ€èµ„æº

#### ç‰¹ç‚¹ï¼š
- ðŸ’¡æžé€Ÿçš„æœåŠ¡å¯åŠ¨ -- ä½¿ç”¨åŽŸç”Ÿ ESM æ–‡ä»¶ï¼Œæ— éœ€æ‰“åŒ…

ä¼ ç»Ÿæ‰“åŒ…å™¨æ›´å¤šçš„æ˜¯æŠ“å–æ•´ä½“åº”ç”¨è¿›è¡Œç¼–è¯‘ï¼Œviteæ˜¯æ€Žä¹ˆæ”¹è¿›å¼€å‘æœåŠ¡å™¨å¯åŠ¨æ—¶é—´çš„ã€‚
1. ä¾èµ–ï¼šç”¨esbuildé¢„æž„å»ºä¾èµ–ï¼Œesbuildä½¿ç”¨goè¯­è¨€ç¼–å†™ï¼Œæž„å»ºé€Ÿåº¦å¿«10-100å€
2. æºç ï¼šéžjsæ–‡ä»¶éœ€è¦è¢«è½¬æ¢ï¼Œviteä½¿ç”¨`åŽŸç”ŸESM`æä¾›æºç ï¼Œè¿™å®žé™…ä¸Šæ˜¯è®©æµè§ˆå™¨æŽ¥ç®¡äº†æ‰“åŒ…ç¨‹åºçš„éƒ¨åˆ†å·¥ä½œï¼šVite åªéœ€è¦åœ¨æµè§ˆå™¨è¯·æ±‚æºç æ—¶è¿›è¡Œè½¬æ¢å¹¶æŒ‰éœ€æä¾›æºç ã€‚æ ¹æ®æƒ…æ™¯åŠ¨æ€å¯¼å…¥ä»£ç ï¼Œå³åªåœ¨å½“å‰å±å¹•ä¸Šå®žé™…ä½¿ç”¨æ—¶æ‰ä¼šè¢«å¤„ç†


- âš¡ï¸è½»é‡å¿«é€Ÿçš„çƒ­é‡è½½ -- æ— è®ºåº”ç”¨ç¨‹åºå¤§å°å¦‚ä½•ï¼Œéƒ½å§‹ç»ˆæžå¿«çš„æ¨¡å—çƒ­æ›¿æ¢(HMR)

æ‰“åŒ…å™¨éšç€åº”ç”¨ä½“ç§¯å¢žå¤§ï¼Œæ›´æ–°é‡å»ºé€Ÿåº¦è¶Šæ¥è¶Šæ…¢ï¼Œä¸ç®¡æ˜¯å¼€å¯äº†HMRçš„åº”ç”¨ï¼Œå§‹ç»ˆè¢«æ‹–ç´¯ã€‚
åœ¨ Vite ä¸­ï¼ŒHMR æ˜¯åœ¨åŽŸç”Ÿ ESM ä¸Šæ‰§è¡Œçš„ã€‚å½“ç¼–è¾‘ä¸€ä¸ªæ–‡ä»¶æ—¶,Vite åªéœ€è¦ç²¾ç¡®åœ°ä½¿å·²ç¼–è¾‘çš„æ¨¡å—ä¸Žå…¶æœ€è¿‘çš„ HMR è¾¹ç•Œä¹‹é—´çš„é“¾å¤±æ´»[1]ï¼ˆå¤§å¤šæ•°æ—¶å€™åªæ˜¯æ¨¡å—æœ¬èº«ï¼‰,ä½¿å¾—æ— è®ºåº”ç”¨å¤§å°å¦‚ä½•,HMR å§‹ç»ˆèƒ½ä¿æŒå¿«é€Ÿæ›´æ–°ï¼›åˆ©ç”¨httpè¯·æ±‚åŠ é€Ÿé‡è½½,æ¯”å¦‚cache-controlå¼ºç¼“å­˜ä¾èµ–,åˆ©ç”¨`304 not modified`åå•†ç¼“å­˜,åŠ å¿«å•ä¸ªé¡µé¢çš„æ›´æ–°é€Ÿåº¦,ä¸éœ€è¦å†æ¬¡é‡å¤è¯·æ±‚

- ðŸ› ï¸ä¸°å¯Œçš„åŠŸèƒ½ -- å¯¹ TypeScriptã€JSXã€CSS ç­‰æ”¯æŒå¼€ç®±å³ç”¨
- ðŸ“¦ä¼˜åŒ–çš„æž„å»º -- å¯é€‰ â€œå¤šé¡µåº”ç”¨â€ æˆ– â€œåº“â€ æ¨¡å¼çš„é¢„é…ç½® Rollup æž„å»º
- ðŸ”©é€šç”¨çš„æ’ä»¶ -- åœ¨å¼€å‘å’Œæž„å»ºä¹‹é—´å…±äº« Rollup-superset æ’ä»¶æŽ¥å£
- ðŸ”‘å®Œå…¨ç±»åŒ–çš„api -- çµæ´»çš„ API å’Œå®Œæ•´çš„ TypeScript ç±»åž‹

#### åŠŸèƒ½
1. ä¾èµ–è§£æžå’Œé¢„æž„å»º -- å¼€å‘æ¨¡å¼ä½¿ç”¨,Vite çš„å¼€å‘æœåŠ¡å™¨å°†æ‰€æœ‰ä»£ç è§†ä¸ºåŽŸç”Ÿ ES æ¨¡å—

  ```js
  import { someMethod } from 'my-dep'
  ```
  ä¸ä½¿ç”¨æ‰“åŒ…å™¨ï¼Œä¸Šé¢çš„ä»£ç ä¼šåœ¨æµè§ˆå™¨ä¸­æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚Vite å°†ä¼šæ£€æµ‹åˆ°æ‰€æœ‰è¢«åŠ è½½çš„æºæ–‡ä»¶ä¸­çš„æ­¤ç±»è£¸æ¨¡å—å¯¼å…¥ï¼Œå¹¶æ‰§è¡Œä»¥ä¸‹æ“ä½œ:
  - viteæ‰¾åˆ°å¯¹åº”ä¾èµ–ï¼Œç”¨`esbuild`(å¯¹jsè¯­æ³•å¤„ç†çš„åº“)å°†å…¶ä»–è§„èŒƒï¼ˆcommonjsã€UMDï¼‰çš„ä»£ç è½¬æ¢æˆ`esmodule`,ç„¶åŽæ”¾åˆ°å½“å‰ç›®å½•ä¸‹çš„`node_modules/vite/deps`
  - é‡å†™å¯¼å…¥ä¸ºåˆæ³•çš„ URLï¼Œä¾‹å¦‚ /node_modules/.vite/deps/my-dep.js?v=f3sf2ebd ä»¥ä¾¿æµè§ˆå™¨èƒ½å¤Ÿæ­£ç¡®å¯¼å…¥å®ƒä»¬
  **ä¾èµ–é¢„æž„å»ºç›®çš„**
  - CommonJS æˆ– UMD å‘å¸ƒçš„ä¾èµ–é¡¹ä½¿ç”¨esbuildè½¬æ¢ä¸º ESM
  - æ”¾åœ¨å¯ä»¥ç›´æŽ¥ä½¿ç”¨çš„è·¯å¾„`.vite/deps`,æ–¹ä¾¿è·¯å¾„é‡å†™å¯¼å…¥
  - è§£å†³ç½‘ç»œå¤šåŒ…ä¼ è¾“çš„æ€§èƒ½é—®é¢˜ï¼ˆæ¯”å¦‚ä¸€ä¸ªä¾èµ–å¼•ç”¨å¤šä¸ªä¾èµ–ï¼Œç½‘ç»œéœ€è¦å¤šæ¬¡è¯·æ±‚ï¼‰,viteä¼šå°†è¿™äº›ä¾èµ–é›†æˆä¸ºä¸€ä¸ªæ–‡ä»¶ï¼Œå‡å°‘ç½‘ç»œè¯·æ±‚

1. HMR



#### æ‰©å±•ï¼š
1. æž„å»ºå·¥å…·æ˜¯ä»€ä¹ˆï¼Œåšäº†å“ªäº›å·¥ä½œ?
  å¸¸ç”¨çš„é¡¹ç›®éœ€è¦åš,æµè§ˆå™¨åªè¯†åˆ«js,html,cssä¸‰ç§åŽŸå§‹è¯­æ³•ï¼š
  - å°†tsè½¬æ¢ä¸ºjs
  - vueï¼šå®‰è£…vue-complierï¼Œå°†jsxæˆ–.vueè½¬æ¢ä¸ºrenderå‡½æ•°
  - less/sass: å¯¹åº”loaderå·¥å…·
  - è¯­æ³•é™çº§ï¼šbabel,æ–°è¯­æ³•é™çº§æˆæ—§ç‰ˆæµè§ˆå™¨èƒ½è¯†åˆ«çš„è¯­æ³•
  - ä½“ç§¯ä¼˜åŒ–ï¼šuglifyjs - åŽ‹ç¼©
  - ...

  éœ€è¦å·¥å…·æŠŠä»¥ä¸Šè¿™äº›åŠŸèƒ½é›†æˆåœ¨ä¸€èµ·å¤„ç†ï¼Œæˆ‘ä»¬åªå…³å¿ƒå¯¹åº”çš„ä¸šåŠ¡ä»£ç ï¼Œæ¯æ¬¡æ”¹å˜å¯¹åº”å†…å®¹ï¼Œå·¥å…·åŽ»æ‰§è¡Œä»¥ä¸Šçš„å·¥ä½œ
  **æž„å»ºå·¥å…·å·¥ä½œäº‹é¡¹**ï¼š
  - æ¨¡å—åŒ–å¼€å‘æ”¯æŒï¼šç›´æŽ¥ä»Žnode_moduleså¼•å…¥ä»£ç  + å¤šæ¨¡å—åŒ–æ”¯æŒ
  - å¤„ç†ä»£ç å…¼å®¹ï¼šé›†æˆå¯¹åº”å¤„ç†å·¥å…·
  - æé«˜é¡¹ç›®æ€§èƒ½ï¼šåŽ‹ç¼©ï¼Œåˆ†å‰²
  - ä¼˜åŒ–å¼€å‘ä½“éªŒï¼šHMR
  - å¼€å‘æœåŠ¡å™¨ï¼šè·¨åŸŸ
  - ...

  æž„å»ºå·¥å…·è®©æˆ‘ä»¬ä¸ç”¨å…³å¿ƒä»£ç åœ¨æµè§ˆå™¨å¦‚ä½•è¿è¡Œï¼Œæˆ‘ä»¬åªéœ€è¦é¦–æ¬¡ç»™æž„å»ºå·¥å…·æä¾›ä¸€ä¸ªé…ç½®æ–‡ä»¶(éžå¿…é¡»ï¼Œæœ‰é»˜è®¤é…ç½®é¡¹)ï¼Œæœ‰è¿™ä¸ªé…ç½®ä¹‹åŽï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ä¸‹æ¬¡éœ€è¦æ›´æ–°çš„æ—¶å€™è°ƒç”¨å‘½ä»¤å°±å¥½ï¼Œå¦‚æžœåœ¨ç»“åˆå¦‚æ›´æ–°ï¼Œæˆ‘ä»¬å°±æ›´åŠ ä¸éœ€è¦ç®¡ä»»ä½•äº‹æƒ…ï¼Œè¿™å°±æ˜¯æž„å»ºå·¥å…·åšçš„äº‹æƒ…ï¼Œå®ƒè®©æˆ‘ä»¬ä¸ç”¨å…³å¿ƒç”Ÿäº§ä»£ç ä¹Ÿä¸ç”¨å…³å¿ƒä»£ç å¦‚ä½•åœ¨æµè§ˆå™¨è¿è¡Œï¼Œåªéœ€è¦å…³å¿ƒå¼€å‘ä¸šåŠ¡


2. viteå’Œwebpackçš„åŒºåˆ«ï¼Œä¼˜åŠ¿?

  webpacké—®é¢˜ï¼š
   - é¡¹ç›®è¶Šå¤§ï¼Œwebpackè¦å¤„ç†çš„jsè¶Šå¤šï¼Œæž„å»ºå·¥å…·éœ€è¦å¾ˆé•¿æ—¶é—´æ‰èƒ½å¯åŠ¨å¼€å‘æœåŠ¡å™¨

  webpackæ”¯æŒå¤šç§æ¨¡å—åŒ–(commonjs,esmodule),ä¸€å¼€å§‹å¿…é¡»è¦ç»Ÿä¸€æ¨¡å—åŒ–ä»£ç ï¼Œéœ€è¦å°†æ‰€æœ‰ä¾èµ–éƒ½è¯»ä¸€éï¼Œæ›´å¤šè€ƒè™‘çš„æ˜¯å…¼å®¹æ€§
  ```js
  const lodash = require('lodash')
  import Vue from 'vue'

  // webpackè½¬æ¢ç»“æžœ
  const lodash = webpack_require('lodash')
  const Vue = webpack_require('vue')
  ```

  Viteåˆ©ç”¨äº†æµè§ˆå™¨æ”¯æŒåŽŸç”Ÿesmoduleçš„ä¼˜åŠ¿ï¼Œæžå¤§ä¼˜åŒ–ä½“éªŒã€‚


### è§£å†³çš„é—®é¢˜

å½“æˆ‘ä»¬å¼€å§‹æž„å»ºè¶Šæ¥è¶Šå¤§åž‹çš„åº”ç”¨æ—¶ï¼Œéœ€è¦å¤„ç†çš„ JavaScript ä»£ç é‡ä¹Ÿå‘ˆæŒ‡æ•°çº§å¢žé•¿ã€‚åŒ…å«æ•°åƒä¸ªæ¨¡å—çš„å¤§åž‹é¡¹ç›®ç›¸å½“æ™®éã€‚åŸºäºŽ JavaScript å¼€å‘çš„å·¥å…·å°±ä¼šå¼€å§‹é‡åˆ°æ€§èƒ½ç“¶é¢ˆï¼šé€šå¸¸éœ€è¦å¾ˆé•¿æ—¶é—´ï¼ˆç”šè‡³æ˜¯å‡ åˆ†é’Ÿï¼ï¼‰æ‰èƒ½å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼Œå³ä½¿ä½¿ç”¨æ¨¡å—çƒ­æ›¿æ¢ï¼ˆHMRï¼‰ï¼Œæ–‡ä»¶ä¿®æ”¹åŽçš„æ•ˆæžœä¹Ÿéœ€è¦å‡ ç§’é’Ÿæ‰èƒ½åœ¨æµè§ˆå™¨ä¸­åæ˜ å‡ºæ¥ã€‚å¦‚æ­¤å¾ªçŽ¯å¾€å¤ï¼Œè¿Ÿé’çš„åé¦ˆä¼šæžå¤§åœ°å½±å“å¼€å‘è€…çš„å¼€å‘æ•ˆçŽ‡å’Œå¹¸ç¦æ„Ÿã€‚

`Vite`æ—¨åœ¨åˆ©ç”¨ç”Ÿæ€ç³»ç»Ÿä¸­çš„æ–°è¿›å±•è§£å†³ä¸Šè¿°é—®é¢˜ï¼šæµè§ˆå™¨å¼€å§‹åŽŸç”Ÿæ”¯æŒ ES æ¨¡å—ï¼Œä¸”è¶Šæ¥è¶Šå¤š JavaScript å·¥å…·ä½¿ç”¨ç¼–è¯‘åž‹è¯­è¨€ç¼–å†™.



### å¿«é€Ÿå¼€å§‹


1. å¼€å§‹viteé¡¹ç›®

```bash
pnpm create vite
```
å®žé™…å…¨å±€å®‰è£…`create-vite`å³`vite`è„šæ‰‹æž¶,å¿«é€Ÿç”Ÿæˆä¸»æµæ¡†æž¶åŸºç¡€æ¨¡æ¿,ç„¶åŽç›´æŽ¥è¿è¡Œ`create-vite` **bin**ç›®å½•ä¸‹çš„ä¸€ä¸ªæ‰§è¡Œé…ç½®,äº†è§£`pnpm add vite`å’Œ`pnpm create vite`çš„åŒºåˆ«,viteè„šæ‰‹æž¶æœ‰æœ€ä½³å®žè·µçš„é…ç½®

### å‘½ä»¤

```bash
vite # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
vite build # æ‰§è¡Œåº”ç”¨æž„å»º
vite preview # æž„å»ºå®Œåº”ç”¨åŽï¼Œæœ¬åœ°å¯ä¸€ä¸ªé™æ€æœåŠ¡å™¨ï¼Œé¢„è§ˆæž„å»ºäº§ç‰©
```



### é…ç½®

#### vite.config
```js
export default defineConfig ({
  //
})
```

#### çŽ¯å¢ƒå˜é‡
1. å®žçŽ°
  ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“`dotenv`è¯»å–é…ç½®æ–‡ä»¶`.env`,è§£æžæ–‡ä»¶ä¸­çš„çŽ¯å¢ƒå˜é‡,æ³¨å…¥è¿›processå¯¹è±¡,viteè€ƒè™‘å’Œå…¶ä»–é…ç½®çš„å†²çªä¸ä¼šç›´æŽ¥æ’å…¥process,å¯ä»¥è°ƒç”¨**loadEnv**æ–¹æ³•æ‰‹åŠ¨ç¡®è®¤envæ–‡ä»¶
  - root
  - envDir: ç”¨æ¥é…ç½®å½“å‰çŽ¯å¢ƒå˜é‡çš„æ–‡ä»¶åœ°å€


2. è¡¥å……
- ä¸ºä»€ä¹ˆvite.config.jså¯ä»¥ä¹¦å†™esmoduleçš„å½¢å¼,å› ä¸ºviteåœ¨è¯»å–vite.config.jsçš„æ—¶å€™nodeçŽ‡å…ˆä¼šå°†esmoduleè½¬æ¢æˆcommonjs,nodeå³å¯è¯†åˆ«
- å¦‚æžœçŽ¯å¢ƒå˜é‡ä¸æ˜¯ä»¥`VITE`å¼€å§‹ï¼Œä¸ä¼šåœ¨å®¢æˆ·ç«¯æš´éœ²è‡³import.meta.envï¼Œå¯ä»¥é€šè¿‡`envPrefix`æ‰‹åŠ¨æ›´æ”¹å‰ç¼€

### æ’ä»¶ä»‹ç»


### æ”¯æŒ
viteæµè§ˆå™¨æ”¯æŒ:
- Chrome >=87
- Firefox >=78
- Safari >=14
- Edge >=88